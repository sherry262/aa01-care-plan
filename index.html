<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AA01ç…§é¡§è¨ˆç•«æ“¬è¨‚èˆ‡æœå‹™é€£çµç³»çµ±</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        /* ç°¡å–®ç™»å…¥å€å¡Š */
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .login-container h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .login-form {
            text-align: left;
        }

        .login-form input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
        }

        .user-info {
            background: rgba(40, 167, 69, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: "ğŸ“";
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            gap: 20px;
            margin-bottom: 20px;
            grid-template-columns: repeat(2, 1fr);
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input[type="text"], 
        input[type="date"], 
        textarea, 
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        input[type="text"]:focus, 
        input[type="date"]:focus, 
        textarea:focus, 
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .subsection {
            margin-left: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .subsection h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .service-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #28a745;
        }

        .bcode-item, .code-item {
            display: flex; 
            align-items: center; 
            background: rgba(255,255,255,0.6); 
            padding: 8px; 
            border-radius: 5px; 
            margin: 2px 0;
        }

        .bcode-item input[type="number"] {
            width: 60px; 
            margin-left: 10px; 
            padding: 5px; 
            border: 1px solid #ccc; 
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .required {
            color: #dc3545;
        }

        .note {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            display: none;
        }

        .sync-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .sync-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .sync-status.syncing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-row {
                grid-template-columns: 1fr !important;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .form-container {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            .container {
                max-width: 100%;
                padding: 0;
                margin: 0;
            }
            .header, .login-container, .user-info, .button-group {
                display: none !important;
            }
            .form-container, .section, .subsection, .service-item {
                background: white !important;
                box-shadow: none !important;
                border: none !important;
                padding: 10px !important;
                margin-bottom: 20px;
            }
            .form-container {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AA01 ç…§é¡§è¨ˆç•«æ“¬è¨‚èˆ‡æœå‹™é€£çµç³»çµ±</h1>
            <p>æ¡ƒåœ’å¸‚æ”¿åºœè¡›ç”Ÿå±€é•·æœŸç…§è­·ç§‘ - æ•¸ä½åŒ–ç®¡ç†ç³»çµ±</p>
        </div>

        <!-- ç°¡å–®ç™»å…¥å€å¡Š -->
        <div class="login-container" id="loginContainer">
            <h2>ç³»çµ±ç™»å…¥</h2>
            <p style="margin-bottom: 20px;">è«‹è¼¸å…¥å§“åå’Œå¯†ç¢¼</p>
            <div class="login-form">
                <input type="text" id="userName" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required>
                <input type="password" id="userPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                <button class="btn btn-primary" onclick="login()" style="width: 100%;">ç™»å…¥ç³»çµ±</button>
            </div>
        </div>

        <!-- ä½¿ç”¨è€…è³‡è¨Š -->
        <div class="user-info" id="userInfo" style="display: none;">
            <div>
                <strong>å·²ç™»å…¥ï¼š</strong><span id="displayUserName"></span>
            </div>
            <button class="btn btn-secondary" onclick="logout()">ç™»å‡º</button>
        </div>

        <div class="form-container" id="formContainer">
            <form id="aa01Form">
                <!-- åŸºæœ¬è³‡è¨Š -->
                <div class="section">
                    <h2>åŸºæœ¬è³‡è¨Š</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="visitDate">å®¶è¨ªæ—¥æœŸ <span class="required">*</span></label>
                            <input type="date" id="visitDate" name="visitDate" required>
                        </div>
                        <div class="form-group">
                            <label for="dischargeDate">å‡ºé™¢æ—¥æœŸ (éç¶“å‡ºæº–è©•ä¼°å€‹æ¡ˆå…å¡«)</label>
                            <input type="date" id="dischargeDate" name="dischargeDate">
                        </div>
                    </div>
                    <div class="form-row single">
                        <div class="form-group">
                            <label for="visitWith">å•åŒè¨ªè¦–è€…</label>
                            <input type="text" id="visitWith" name="visitWith" placeholder="åŒ…å«å€‹æ¡ˆã€å®¶å±¬ã€å…¶ä»–å–®ä½äººå“¡ç­‰ç•¶æ—¥åœ¨å ´è€…">
                        </div>
                    </div>
                </div>

                <!-- å€‹æ¡ˆæ¦‚æ³ -->
                <div class="section">
                    <h2>å€‹æ¡ˆæ¦‚æ³</h2>
                    
                    <div class="subsection">
                        <h3>(ä¸€) èº«å¿ƒæ¦‚æ³</h3>
                        <textarea name="physicalMental" placeholder="å¦‚å€‹æ¡ˆæ„è­˜ã€èº«é«”åŠŸèƒ½ã€èº«éšœé¡åˆ¥/ç­‰ç´šã€ç–¾ç—…å²ã€å°±é†«èˆ‡ç”¨è—¥æƒ…å½¢ç­‰"></textarea>
                    </div>

                    <div class="subsection">
                        <h3>(äºŒ) ç¶“æ¿Ÿæ”¶å…¥</h3>
                        <textarea name="economicIncome" placeholder="å¦‚æ”¶å…¥ã€ç¶“æ¿Ÿä¾†æºã€ç¦åˆ©è£œåŠ©ã€èº«éšœç­‰ç´šã€ä½æ”¶å…¥ç­‰èº«åˆ†åˆ¥ç­‰"></textarea>
                    </div>

                    <div class="subsection">
                        <h3>(ä¸‰) å±…ä½ç’°å¢ƒ</h3>
                        <textarea name="livingEnvironment" placeholder="å¦‚å±…ä½å‹æ…‹ã€ç’°å¢ƒæ•´æ½”åº¦ã€è¼”å…·æˆ–ç„¡éšœç¤™ç¾æ³ç­‰"></textarea>
                    </div>

                    <div class="subsection">
                        <h3>(å››) ç¤¾æœƒæ”¯æŒ</h3>
                        <textarea name="socialSupport" placeholder="å¦‚å®¶åº­æ”¯æŒåº¦(ä¸»ç…§è€…ã€ä¸»è¦è¯ç¹«äººã€æ±ºç­–è€…æˆ–å…¶ä»–å®¶å±¬æ”¯æŒã€æ­£å¼æˆ–éæ­£å¼è³‡æºç­‰(é„°é‡Œé—œä¿‚ã€ç¤¾å€è³‡æºç­‰ï¼Œå«é«˜é¢¨éšªè©•ä¼°)"></textarea>
                    </div>

                    <div class="subsection">
                        <h3>(äº”) å…¶ä»–</h3>
                        <textarea name="others" placeholder="å¦‚å€‹æ¡ˆæˆé•·èƒŒæ™¯ã€è·æ¥­ã€ç”Ÿæ´»ç¿’æ…£ã€åƒ¹å€¼è§€ç­‰"></textarea>
                    </div>

                    <div class="subsection">
                        <h3>(å…­) è¤‡è©•è©•å€¼</h3>
                        <textarea name="reevaluation" placeholder="åŸ·è¡Œè¤‡è©•æˆ–AA01æ™‚æ–¼æ­¤æ’°å¯«å€‹æ¡ˆæœå‹™çš„é‹ç”¨æƒ…å½¢ã€ä»‹å…¥å¾ŒåŠæ”¹å–„å¾Œçš„ç¾æ³åŠæ˜¯å¦éœ€èª¿æ•´ç…§é¡§ç›®æ¨™ç­‰ï¼Œæ–°æ¡ˆå‰‡å…å¡«"></textarea>
                    </div>
                </div>

                <!-- ç…§é¡§ç›®æ¨™ -->
                <div class="section">
                    <h2>ç…§é¡§ç›®æ¨™</h2>
                    <div class="note">
                        ç›®æ¨™è«‹èˆ‡å•é¡Œæ¸…å–®ã€æœå‹™é …ç›®ã€è³‡æºç¾æ³èˆ‡å•é¡Œç¾æ³ç›¸å¥‘åˆï¼Œä¹Ÿå¯æ“¬å®šçŸ­ä¸­é•·æœŸç›®æ¨™ï¼Œç›®æ¨™éœ€æ˜ç¢ºä¸”æœ‰åˆ©æ–¼å€‹ç®¡å“¡é€²è¡Œè¿½è¹¤æ™‚ï¼Œå¯è©•å€¼ç›®æ¨™é”æˆæƒ…å½¢
                    </div>
                    
                    <div class="form-group">
                        <label for="previousGoals">ä¸Šæ¬¡è¨ˆç•«ç›®æ¨™é”æˆæƒ…å½¢åŠæœªè¨­ç›®æ¨™å•é¡Œè¿½è¹¤</label>
                        <textarea id="previousGoals" name="previousGoals" placeholder="ä¾‹ï¼šä¸Šæ¬¡å•é¡Œæ¸…å–®:1.è™•ç†å®¶å‹™å•é¡Œ 2.èµ°è·¯å•é¡Œ 3.è³¼ç‰©åŠå¤–å‡ºå•é¡Œ 4.å®‰å…¨ç–‘æ…® 5.ç§»ä½å•é¡Œ"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="currentGoals">æœ¬æ¬¡å•é¡Œæ¸…å–®åŠç›®æ¨™è¨­å®š</label>
                        <textarea id="currentGoals" name="currentGoals" placeholder="ä¾‹ï¼šæœ¬æ¬¡å•é¡Œæ¸…å–®:1.è™•ç†å®¶å‹™å•é¡Œ 2.è³¼ç‰©åŠå¤–å‡ºå•é¡Œ 3.æ´—æ¾¡å•é¡Œ 4.å®‰å…¨ç–‘æ…® 5.ç§»ä½å•é¡Œ"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="inconsistencyReason">èˆ‡ç…§å°ˆå»ºè­°æœå‹™é …ç›®ã€å•é¡Œæ¸…å–®ä¸ä¸€è‡´åŸå› èªªæ˜åŠæœªä¾†è¦åŠƒã€å¾ŒçºŒè¿½è¹¤è¨ˆåŠƒç­‰</label>
                        <textarea id="inconsistencyReason" name="inconsistencyReason" placeholder="ä¾‹ï¼š1.ç›®æ¨™é”æˆçš„ç‹€æ³ä»¥åŠæœªé”æˆçš„å·®è· 2.è³‡æºçš„è®Šå‹•æƒ…å½¢ 3.æœªä½¿ç”¨çš„æ›¿ä»£æ–¹æ¡ˆæˆ–æ˜¯å¯èƒ½çš„å½±éŸ¿"></textarea>
                    </div>
                </div>

                <!-- è¨ˆç•«åŸ·è¡Œè¦åŠƒ -->
                <div class="section">
                    <h2>è¨ˆç•«åŸ·è¡Œè¦åŠƒ</h2>
                    
                    <div class="subsection">
                        <h3>é•·ç…§æœå‹™æ ¸å®šé …ç›®ã€é »ç‡</h3>
                        
                        <!-- Bç¢¼æœå‹™ -->
                        <div class="service-item">
                            <label>Bç¢¼æœå‹™ (è¼ªæ´¾/æŒ‡å®šå–®ä½)</label>
                            <div style="margin-bottom: 15px;">
                                <button type="button" class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px; margin-right: 10px;" onclick="selectAllBCodes()">
                                    å…¨é¸Bç¢¼
                                </button>
                                <button type="button" class="btn btn-warning" style="padding: 8px 16px; font-size: 12px;" onclick="clearAllBCodes()">
                                    æ¸…é™¤Bç¢¼
                                </button>
                            </div>
                            <div id="bCodeContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; margin: 15px 0; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                                <!-- Bç¢¼é¸é …æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                            <textarea name="bCodeNotes" id="bCodeNotes" placeholder="Bç¢¼æœå‹™å‚™è¨»ï¼ˆé¸å–é …ç›®æœƒè‡ªå‹•é¡¯ç¤ºåœ¨é€™è£¡ï¼‰" style="margin-top: 10px;" readonly></textarea>
                        </div>

                        <!-- Cç¢¼æœå‹™ -->
                        <div class="service-item">
                            <label>Cç¢¼æœå‹™ (è¼ªæ´¾/æŒ‡å®šå–®ä½)</label>
                            <textarea name="cCode" placeholder="æœå‹™ä»£ç¢¼+å€‹æ¡ˆåŠå®¶å±¬æœ€å¸Œæœ›æ”¹å–„ä¹‹æ—¥å¸¸ç”Ÿæ´»æ´»å‹•é …ç›®..."></textarea>
                        </div>

                        <!-- Dç¢¼æœå‹™ -->
                        <div class="service-item">
                            <label>Dç¢¼æœå‹™</label>
                            <div style="margin-bottom: 15px;">
                                <button type="button" class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px; margin-right: 10px;" onclick="selectAllDCodes()">
                                    å…¨é¸Dç¢¼
                                </button>
                                <button type="button" class="btn btn-warning" style="padding: 8px 16px; font-size: 12px;" onclick="clearAllDCodes()">
                                    æ¸…é™¤Dç¢¼
                                </button>
                            </div>
                            <div id="dCodeContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; margin: 15px 0; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                                <!-- Dç¢¼é¸é …æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                            <textarea name="dCodeNotes" id="dCodeNotes" placeholder="Dç¢¼æœå‹™å‚™è¨»ï¼ˆé¸å–é …ç›®æœƒè‡ªå‹•é¡¯ç¤ºåœ¨é€™è£¡ï¼‰" style="margin-top: 10px;" readonly></textarea>
                        </div>

                        <!-- EFç¢¼æœå‹™ -->
                        <div class="service-item">
                            <label>EFç¢¼æœå‹™</label>
                            <div style="margin-bottom: 15px;">
                                <button type="button" class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px; margin-right: 10px;" onclick="selectAllEFCodes()">
                                    å…¨é¸EFç¢¼
                                </button>
                                <button type="button" class="btn btn-warning" style="padding: 8px 16px; font-size: 12px;" onclick="clearAllEFCodes()">
                                    æ¸…é™¤EFç¢¼
                                </button>
                            </div>
                            <div id="efCodeContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; margin: 15px 0; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                                <!-- EFç¢¼é¸é …æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                            <textarea name="efCodeNotes" id="efCodeNotes" placeholder="EFç¢¼æœå‹™å‚™è¨»ï¼ˆé¸å–é …ç›®æœƒè‡ªå‹•é¡¯ç¤ºåœ¨é€™è£¡ï¼‰" style="margin-top: 10px;" readonly></textarea>
                        </div>

                        <!-- Gç¢¼æœå‹™ -->
                        <div class="service-item">
                            <label>Gç¢¼æœå‹™</label>
                            <textarea name="gCode" placeholder="æœå‹™ä»£ç¢¼+å€‹æ¡ˆåŠå®¶å±¬æœ€å¸Œæœ›æ”¹å–„ä¹‹æ—¥å¸¸ç”Ÿæ´»æ´»å‹•é …ç›®..."></textarea>
                        </div>

                        <!-- SCç¢¼ -->
                        <div class="service-item">
                            <label>SCç¢¼</label>
                            <textarea name="scCode" placeholder="æœå‹™ä»£ç¢¼+å€‹æ¡ˆåŠå®¶å±¬æœ€å¸Œæœ›æ”¹å–„ä¹‹æ—¥å¸¸ç”Ÿæ´»æ´»å‹•é …ç›®..."></textarea>
                        </div>

                        <!-- ç‡Ÿé¤Šé¤é£²æœå‹™ -->
                        <div class="service-item">
                            <label>ç‡Ÿé¤Šé¤é£²æœå‹™</label>
                            <textarea name="mealService" placeholder="æœå‹™å…§å®¹èªªæ˜..."></textarea>
                        </div>

                        <!-- ç·Šæ€¥æ•‘æ´æœå‹™ -->
                        <div class="service-item">
                            <label>ç·Šæ€¥æ•‘æ´æœå‹™</label>
                            <textarea name="emergencyService" placeholder="æœå‹™å…§å®¹èªªæ˜..."></textarea>
                        </div>

                        <!-- è½‰ä»‹å…¶ä»–æœå‹™è³‡æº -->
                        <div class="service-item">
                            <label>è½‰ä»‹å…¶ä»–æœå‹™è³‡æº</label>
                            <textarea name="referralServices" placeholder="è½‰ä»‹å…§å®¹èªªæ˜..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- å€‹æ¡ˆç®¡ç†å“¡ -->
                <div class="section">
                    <h2>å€‹æ¡ˆç®¡ç†å“¡</h2>
                    <div class="form-group">
                        <label for="caseManager">å€‹æ¡ˆç®¡ç†å“¡å§“å</label>
                        <input type="text" id="caseManager" name="caseManager" placeholder="è«‹è¼¸å…¥å€‹æ¡ˆç®¡ç†å“¡å§“å">
                    </div>
                </div>

                <!-- å…¶ä»–å‚™è¨» -->
                <div class="section">
                    <h2>å…¶ä»–å‚™è¨»</h2>
                    <div class="form-group">
                        <textarea name="additionalNotes" placeholder="å…¶ä»–éœ€è¦è¨˜éŒ„çš„äº‹é …..."></textarea>
                    </div>
                </div>

                <!-- æŒ‰éˆ•ç¾¤çµ„ -->
                <div class="button-group">
                    <button type="button" class="btn btn-primary" onclick="manualSync()">
                        ğŸ’¾ æ‰‹å‹•åŒæ­¥
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="testGoogleConnection()">
                        ğŸ”— æ¸¬è©¦Googleé€£ç·š
                    </button>
                    <button type="button" class="btn btn-warning" onclick="clearForm()">
                        ğŸ—‘ï¸ æ¸…é™¤è³‡æ–™
                    </button>
                    <button type="button" class="btn btn-danger" onclick="exportPDF()">
                        ğŸ“„ åŒ¯å‡ºPDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- åŒæ­¥ç‹€æ…‹é¡¯ç¤º -->
    <div id="syncStatus" class="sync-status"></div>

    <script>
        // ========== è¨­å®šå€åŸŸ ==========
        const GOOGLE_APPS_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'; // è«‹æ›¿æ›ç‚ºæ‚¨çš„ Google Apps Script URL
        
        // ç™»å…¥ç‹€æ…‹
        let isLoggedIn = false;
        let currentUser = '';

        // ========== ç™»å…¥ç³»çµ± ==========
        function login() {
            const userName = document.getElementById('userName').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            
            if (!userName || !password) {
                alert('è«‹è¼¸å…¥å§“åå’Œå¯†ç¢¼');
                return;
            }
            
            // ç°¡å–®å¯†ç¢¼é©—è­‰ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼ï¼‰
            if (password === 'corn783ivy056' || password === '123456') {
                isLoggedIn = true;
                currentUser = userName;
                
                // éš±è—ç™»å…¥å€å¡Šï¼Œé¡¯ç¤ºè¡¨å–®
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('formContainer').style.display = 'block';
                document.getElementById('displayUserName').textContent = userName;
                
                // åˆå§‹åŒ–è¡¨å–®
                initializeForm();
                
                // å•Ÿå‹•è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨
                startAutoSyncTimer();
                
                console.log(`ç”¨æˆ¶ ${userName} å·²ç™»å…¥`);
            } else {
                alert('å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥');
            }
        }

        // ç™»å‡ºç³»çµ±
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                isLoggedIn = false;
                currentUser = '';
                
                // åœæ­¢è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨
                stopAutoSyncTimer();
                
                // é¡¯ç¤ºç™»å…¥å€å¡Šï¼Œéš±è—è¡¨å–®
                document.getElementById('loginContainer').style.display = 'block';
                document.getElementById('userInfo').style.display = 'none';
                document.getElementById('formContainer').style.display = 'none';
                
                // æ¸…ç©ºç™»å…¥æ¬„ä½
                document.getElementById('userName').value = '';
                document.getElementById('userPassword').value = '';
                
                console.log('ç”¨æˆ¶å·²ç™»å‡º');
            }
        }

        // ========== è¡¨å–®åˆå§‹åŒ– ==========
        function initializeForm() {
            // è¨­å®šä»Šå¤©çš„æ—¥æœŸç‚ºé è¨­å€¼
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('visitDate').value = today;
            
            // åˆå§‹åŒ–æœå‹™ä»£ç¢¼é¸é …
            initializeBCodes();
            initializeDCodes();
            initializeEFCodes();
            
            // ç¶å®šäº‹ä»¶ç›£è½å™¨
            bindEventListeners();
            
            console.log('è¡¨å–®åˆå§‹åŒ–å®Œæˆ');
        }

        // ç¶å®šäº‹ä»¶ç›£è½å™¨
        function bindEventListeners() {
            // é˜²æŠ–çš„è‡ªå‹•åŒæ­¥
            const debouncedAutoSync = debounce(autoSync, 2000);
            
            // ç‚ºæ‰€æœ‰è¼¸å…¥æ¬„ä½æ·»åŠ è®Šæ›´ç›£è½å™¨
            document.querySelectorAll('input, textarea, select').forEach(element => {
                element.addEventListener('input', debouncedAutoSync);
                element.addEventListener('change', debouncedAutoSync);
            });
        }

        // ========== æœå‹™ä»£ç¢¼åˆå§‹åŒ– ==========
        
        // åˆå§‹åŒ–Bç¢¼é¸é …
        function initializeBCodes() {
            const bCodes = [
                'BA01 èº«é«”ç…§é¡§æœå‹™', 'BA02 æ—¥å¸¸ç”Ÿæ´»ç…§é¡§æœå‹™', 'BA03 å®¶äº‹æœå‹™',
                'BA04 å®‰å…¨çœ‹è¦–æœå‹™', 'BA05 é™ªä¼´æœå‹™', 'BA06 å·¡è¦–æœå‹™',
                'BB01 æ²æµ´è»Šåˆ°å®…æœå‹™', 'BB02 åˆ°å®…æ²æµ´æœå‹™'
            ];
            
            const container = document.getElementById('bCodeContainer');
            container.innerHTML = '';
            
            bCodes.forEach(code => {
                const item = document.createElement('div');
                item.className = 'bcode-item';
                item.innerHTML = `
                    <input type="checkbox" value="${code}" onchange="updateServiceNotes(); autoSync();">
                    <span style="flex: 1; margin-left: 8px;">${code}</span>
                    <input type="number" min="0" max="999" placeholder="æ¬¡æ•¸" onchange="updateServiceNotes(); autoSync();">
                `;
                container.appendChild(item);
            });
        }

        // åˆå§‹åŒ–Dç¢¼é¸é …
        function initializeDCodes() {
            const dCodes = [
                'DA01 ç‡Ÿé¤Šé¤é£²æœå‹™', 'DA02 é€é¤æœå‹™', 'DA03 é¤å…·æ¸…æ´—',
                'DB01 å±…å®¶ç’°å¢ƒæ”¹å–„æœå‹™', 'DB02 ç”Ÿæ´»è¼”å…·æœå‹™', 'DB03 ç„¡éšœç¤™è¨­æ–½æ”¹å–„'
            ];
            
            const container = document.getElementById('dCodeContainer');
            container.innerHTML = '';
            
            dCodes.forEach(code => {
                const item = document.createElement('div');
                item.className = 'code-item';
                item.innerHTML = `
                    <input type="checkbox" value="${code}" onchange="updateServiceNotes(); autoSync();">
                    <span style="margin-left: 8px;">${code}</span>
                `;
                container.appendChild(item);
            });
        }

        // åˆå§‹åŒ–EFç¢¼é¸é …
        function initializeEFCodes() {
            const efCodes = [
                'EA01 äº¤é€šæ¥é€æœå‹™', 'EA02 é™ªåŒå¤–å‡ºæœå‹™', 'EA03 ä»£è³¼æœå‹™',
                'EB01 å®¶åº­æ‰˜é¡§æœå‹™', 'EB02 æ—¥é–“ç…§é¡§æœå‹™', 'EB03 è‡¨æ™‚ä½å®¿æœå‹™'
            ];
            
            const container = document.getElementById('efCodeContainer');
            container.innerHTML = '';
            
            efCodes.forEach(code => {
                const item = document.createElement('div');
                item.className = 'code-item';
                item.innerHTML = `
                    <input type="checkbox" value="${code}" onchange="updateServiceNotes(); autoSync();">
                    <span style="margin-left: 8px;">${code}</span>
                `;
                container.appendChild(item);
            });
        }

        // ========== æœå‹™ä»£ç¢¼æ“ä½œå‡½å¼ ==========
        
        // Bç¢¼å…¨é¸
        function selectAllBCodes() {
            document.querySelectorAll('#bCodeContainer input[type="checkbox"]').forEach(cb => cb.checked = true);
            updateServiceNotes();
            autoSync();
        }

        // Bç¢¼æ¸…é™¤
        function clearAllBCodes() {
            document.querySelectorAll('#bCodeContainer input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('#bCodeContainer input[type="number"]').forEach(input => input.value = '');
            updateServiceNotes();
            autoSync();
        }

        // Dç¢¼å…¨é¸
        function selectAllDCodes() {
            document.querySelectorAll('#dCodeContainer input[type="checkbox"]').forEach(cb => cb.checked = true);
            updateServiceNotes();
            autoSync();
        }

        // Dç¢¼æ¸…é™¤
        function clearAllDCodes() {
            document.querySelectorAll('#dCodeContainer input[type="checkbox"]').forEach(cb => cb.checked = false);
            updateServiceNotes();
            autoSync();
        }

        // EFç¢¼å…¨é¸
        function selectAllEFCodes() {
            document.querySelectorAll('#efCodeContainer input[type="checkbox"]').forEach(cb => cb.checked = true);
            updateServiceNotes();
            autoSync();
        }

        // EFç¢¼æ¸…é™¤
        function clearAllEFCodes() {
            document.querySelectorAll('#efCodeContainer input[type="checkbox"]').forEach(cb => cb.checked = false);
            updateServiceNotes();
            autoSync();
        }

        // ========== è‡ªå‹•æ›´æ–°æœå‹™å‚™è¨» ==========
        
        function updateServiceNotes() {
            try {
                // æ›´æ–°Bç¢¼å‚™è¨»
                const bCodeItems = [];
                document.querySelectorAll('#bCodeContainer .bcode-item').forEach(item => {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    const countInput = item.querySelector('input[type="number"]');
                    if (checkbox && countInput) {
                        const code = checkbox.value;
                        const count = parseInt(countInput.value) || 0;

                        if (checkbox.checked) {
                            if (count > 0) {
                                bCodeItems.push(`${code} Ã— ${count}æ¬¡`);
                            } else {
                                bCodeItems.push(code);
                            }
                        }
                    }
                });
                
                const bCodeNotesElement = document.getElementById('bCodeNotes');
                if (bCodeNotesElement) {
                    bCodeNotesElement.value = bCodeItems.join('ã€');
                }

                // æ›´æ–°Dç¢¼å‚™è¨»
                const dCodeItems = [];
                document.querySelectorAll('#dCodeContainer input[type="checkbox"]:checked').forEach(cb => {
                    dCodeItems.push(cb.value);
                });
                
                const dCodeNotesElement = document.getElementById('dCodeNotes');
                if (dCodeNotesElement) {
                    dCodeNotesElement.value = dCodeItems.join('ã€');
                }

                // æ›´æ–°EFç¢¼å‚™è¨»
                const efCodeItems = [];
                document.querySelectorAll('#efCodeContainer input[type="checkbox"]:checked').forEach(cb => {
                    efCodeItems.push(cb.value);
                });
                
                const efCodeNotesElement = document.getElementById('efCodeNotes');
                if (efCodeNotesElement) {
                    efCodeNotesElement.value = efCodeItems.join('ã€');
                }
                
                console.log('æœå‹™å‚™è¨»å·²æ›´æ–°'); // é™¤éŒ¯ç”¨
            } catch (error) {
                console.error('æ›´æ–°æœå‹™å‚™è¨»å¤±æ•—:', error);
            }
        }

        // æ”¶é›†è¡¨å–®è³‡æ–™
        function collectFormData() {
            const formData = new FormData(document.getElementById('aa01Form'));
            const data = Object.fromEntries(formData.entries());
            
            // æ”¶é›†Bç¢¼è³‡æ–™
            const bCodeData = {};
            document.querySelectorAll('#bCodeContainer .bcode-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const countInput = item.querySelector('input[type="number"]');
                const code = checkbox.value;
                const count = parseInt(countInput.value) || 0;
                
                bCodeData[code] = {
                    selected: checkbox.checked,
                    count: count
                };
            });
            data.bCodeData = JSON.stringify(bCodeData);
            
            // æ”¶é›†å…¶ä»–é¸é …
            data.selectedDCodes = Array.from(document.querySelectorAll('#dCodeContainer input[type="checkbox"]:checked')).map(cb => cb.value).join('ã€');
            data.selectedEFCodes = Array.from(document.querySelectorAll('#efCodeContainer input[type="checkbox"]:checked')).map(cb => cb.value).join('ã€');
            
            // æ·»åŠ æ™‚é–“æˆ³è¨˜å’Œä½¿ç”¨è€…è³‡è¨Š
            data.lastUpdated = new Date().toISOString();
            data.userName = currentUser;
            
            return data;
        }

        // ä¿®æ­£å¾Œçš„è‡ªå‹•åŒæ­¥åˆ° Google Sheets
        async function autoSync() {
            if (!isLoggedIn) {
                console.log('æœªç™»å…¥ï¼Œè·³éè‡ªå‹•åŒæ­¥');
                return;
            }
            
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                console.log('Google Apps Script URL æœªè¨­å®šï¼Œè·³éè‡ªå‹•åŒæ­¥');
                return;
            }
            
            try {
                console.log('é–‹å§‹è‡ªå‹•åŒæ­¥...');
                showSyncStatus('åŒæ­¥ä¸­...', 'syncing');
                
                const data = collectFormData();
                console.log('æ”¶é›†åˆ°çš„è³‡æ–™:', data);
                
                // ä¿®æ­£å¾Œçš„è«‹æ±‚æ–¹å¼ - å¢åŠ æ›´å¤šéŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ç§’è¶…æ™‚
                
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'save',
                        data: data
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('åŒæ­¥çµæœ:', result);
                
                if (result.success) {
                    showSyncStatus('è³‡æ–™å·²åŒæ­¥åˆ°Googleè¡¨å–® âœ“', 'success');
                    console.log('è‡ªå‹•åŒæ­¥æˆåŠŸ');
                } else {
                    throw new Error(result.error || 'åŒæ­¥å¤±æ•—');
                }
                
            } catch (error) {
                console.error('è‡ªå‹•åŒæ­¥å¤±æ•—:', error);
                
                // æ›´è©³ç´°çš„éŒ¯èª¤è™•ç†
                if (error.name === 'AbortError') {
                    showSyncStatus('è«‹æ±‚è¶…æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                } else if (error.name === 'TypeError' && error.message.includes('CORS')) {
                    showSyncStatus('CORSéŒ¯èª¤ï¼šè«‹æª¢æŸ¥Apps Scriptè¨­å®š', 'error');
                } else if (error.message.includes('Failed to fetch')) {
                    showSyncStatus('ç¶²è·¯éŒ¯èª¤ï¼šè«‹æª¢æŸ¥é€£ç·š', 'error');
                } else {
                    showSyncStatus(`åŒæ­¥å¤±æ•—: ${error.message}`, 'error');
                }
            }
        }

        // ä¿®æ­£å¾Œçš„æ‰‹å‹•åŒæ­¥åŠŸèƒ½
        async function manualSync() {
            if (!isLoggedIn) {
                alert('è«‹å…ˆç™»å…¥ç³»çµ±');
                return;
            }
            
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                alert('è«‹å…ˆè¨­å®šGoogle Apps Script URL\n\nè«‹åœ¨ GitHub çš„ index.html æª”æ¡ˆä¸­\næ‰¾åˆ° GOOGLE_APPS_SCRIPT_URL ä¸¦æ›´æ–°ç‚ºæ‚¨çš„å¯¦éš›URL');
                return;
            }
            
            console.log('æ‰‹å‹•åŒæ­¥é–‹å§‹...');
            console.log('ä½¿ç”¨ URL:', GOOGLE_APPS_SCRIPT_URL);
            
            // å…ˆæ¸¬è©¦é€£ç·š
            try {
                showSyncStatus('æ¸¬è©¦é€£ç·šä¸­...', 'syncing');
                
                // å…ˆç™¼é€ä¸€å€‹ç°¡å–®çš„GETè«‹æ±‚æ¸¬è©¦é€£ç·š
                const testResponse = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                if (testResponse.ok) {
                    const testResult = await testResponse.json();
                    console.log('é€£ç·šæ¸¬è©¦æˆåŠŸ:', testResult);
                    
                    // é€£ç·šæˆåŠŸå¾Œé€²è¡Œå¯¦éš›åŒæ­¥
                    await autoSync();
                } else {
                    throw new Error(`é€£ç·šæ¸¬è©¦å¤±æ•—: ${testResponse.status} ${testResponse.statusText}`);
                }
                
            } catch (error) {
                console.error('æ‰‹å‹•åŒæ­¥å¤±æ•—:', error);
                showSyncStatus('åŒæ­¥å¤±æ•—ï¼Œè«‹æŸ¥çœ‹Console', 'error');
                
                // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤èªªæ˜
                let errorMessage = `åŒæ­¥å¤±æ•—ï¼\n\néŒ¯èª¤ï¼š${error.message}\n\n`;
                
                if (error.message.includes('CORS')) {
                    errorMessage += 'å¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆï¼š\n';
                    errorMessage += '1. ç¢ºèª Apps Script å·²æ­£ç¢ºéƒ¨ç½²\n';
                    errorMessage += '2. æª¢æŸ¥éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äººã€\n';
                    errorMessage += '3. ç¢ºèª Apps Script åŒ…å« doOptions å‡½å¼\n';
                    errorMessage += '4. å˜—è©¦é‡æ–°éƒ¨ç½² Apps Script';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage += 'å¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆï¼š\n';
                    errorMessage += '1. æª¢æŸ¥ç¶²è·¯é€£ç·š\n';
                    errorMessage += '2. ç¢ºèª Apps Script URL æ˜¯å¦æ­£ç¢º\n';
                    errorMessage += '3. æª¢æŸ¥é˜²ç«ç‰†è¨­å®š';
                } else {
                    errorMessage += 'è«‹æª¢æŸ¥ï¼š\n';
                    errorMessage += '1. Google Apps Script URL æ˜¯å¦æ­£ç¢º\n';
                    errorMessage += '2. Apps Script éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äººã€\n';
                    errorMessage += '3. ç€è¦½å™¨Consoleçš„è©³ç´°éŒ¯èª¤è¨Šæ¯';
                }
                
                alert(errorMessage);
            }
        }

        // ä¿®æ­£å¾Œçš„æ¸¬è©¦é€£ç·šåŠŸèƒ½
        async function testGoogleConnection() {
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                alert('è«‹å…ˆè¨­å®š Google Apps Script URL');
                return;
            }
            
            try {
                console.log('æ¸¬è©¦ Google Apps Script é€£ç·š...');
                console.log('URL:', GOOGLE_APPS_SCRIPT_URL);
                
                showSyncStatus('æ¸¬è©¦é€£ç·šä¸­...', 'syncing');
                
                // å…ˆæ¸¬è©¦ OPTIONS è«‹æ±‚ï¼ˆé æª¢è«‹æ±‚ï¼‰
                try {
                    const optionsResponse = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'OPTIONS',
                        mode: 'cors'
                    });
                    console.log('OPTIONS è«‹æ±‚ç‹€æ…‹:', optionsResponse.status);
                    console.log('OPTIONS å›æ‡‰æ¨™é ­:', [...optionsResponse.headers.entries()]);
                } catch (optionsError) {
                    console.warn('OPTIONS è«‹æ±‚å¤±æ•—:', optionsError);
                }
                
                // æ¸¬è©¦ GET è«‹æ±‚
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                console.log('GET è«‹æ±‚ç‹€æ…‹:', response.status);
                console.log('GET å›æ‡‰æ¨™é ­:', [...response.headers.entries()]);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('æ¸¬è©¦å›æ‡‰è³‡æ–™:', data);
                
                if (data.success) {
                    showSyncStatus('é€£ç·šæ¸¬è©¦æˆåŠŸ âœ“', 'success');
                    alert('Google Apps Script é€£ç·šæˆåŠŸï¼\n\n' + data.message + '\n\nç‰ˆæœ¬ï¼š' + (data.version || 'æœªçŸ¥'));
                } else {
                    throw new Error(data.error || 'æœªçŸ¥éŒ¯èª¤');
                }
                
            } catch (error) {
                console.error('é€£ç·šæ¸¬è©¦éŒ¯èª¤:', error);
                showSyncStatus('é€£ç·šæ¸¬è©¦å¤±æ•—', 'error');
                
                let errorMessage = 'é€£ç·šæ¸¬è©¦å¤±æ•—ï¼š\n\n' + error.message + '\n\n';
                
                if (error.message.includes('CORS')) {
                    errorMessage += 'é€™æ˜¯ CORS éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ï¼š\n';
                    errorMessage += '1. Apps Script æ˜¯å¦åŒ…å« doOptions å‡½å¼\n';
                    errorMessage += '2. éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äººã€\n';
                    errorMessage += '3. æ˜¯å¦ä½¿ç”¨æœ€æ–°çš„éƒ¨ç½²ç‰ˆæœ¬';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage += 'é€™æ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ï¼š\n';
                    errorMessage += '1. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸\n';
                    errorMessage += '2. Apps Script URL æ˜¯å¦æ­£ç¢º\n';
                    errorMessage += '3. é˜²ç«ç‰†æ˜¯å¦é˜»æ“‹è«‹æ±‚';
                }
                
                errorMessage += '\n\nè«‹æŸ¥çœ‹ç€è¦½å™¨ Console ç²å–è©³ç´°è³‡è¨Š';
                alert(errorMessage);
            }
        }

        // 30ç§’è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨
        let autoSyncTimer = null;

        // å•Ÿå‹•è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨
        function startAutoSyncTimer() {
            // å…ˆæ¸…é™¤ç¾æœ‰è¨ˆæ™‚å™¨
            if (autoSyncTimer) {
                clearInterval(autoSyncTimer);
            }
            
            // è¨­å®š30ç§’è¨ˆæ™‚å™¨
            autoSyncTimer = setInterval(function() {
                if (isLoggedIn && GOOGLE_APPS_SCRIPT_URL && GOOGLE_APPS_SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    console.log('30ç§’è‡ªå‹•åŒæ­¥è§¸ç™¼');
                    autoSync();
                }
            }, 30000); // 30ç§’ = 30000æ¯«ç§’
            
            console.log('30ç§’è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨å·²å•Ÿå‹•');
        }

        // åœæ­¢è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨
        function stopAutoSyncTimer() {
            if (autoSyncTimer) {
                clearInterval(autoSyncTimer);
                autoSyncTimer = null;
                console.log('30ç§’è‡ªå‹•åŒæ­¥è¨ˆæ™‚å™¨å·²åœæ­¢');
            }
        }

        // æ¸…é™¤è¡¨å–®è³‡æ–™
        function clearForm() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                document.getElementById('aa01Form').reset();
                
                // æ¸…é™¤æ‰€æœ‰å‹¾é¸æ¡†
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
                
                // æ¸…é™¤æœå‹™å‚™è¨»
                setTimeout(() => {
                    updateServiceNotes();
                }, 100); // å»¶é²ä¸€é»ç¢ºä¿resetå®Œæˆ
                
                showSyncStatus('è³‡æ–™å·²æ¸…é™¤', 'success');
                
                // å»¶é²åŒæ­¥ï¼Œç¢ºä¿å‚™è¨»å·²æ›´æ–°
                setTimeout(() => {
                    autoSync();
                }, 200);
            }
        }

        // åŒ¯å‡ºPDF
        function exportPDF() {
            showSyncStatus('æº–å‚™åŒ¯å‡ºPDF...', 'syncing');
            setTimeout(() => {
                window.print();
                showSyncStatus('PDFåŒ¯å‡ºå®Œæˆ', 'success');
            }, 1000);
        }

        // é¡¯ç¤ºåŒæ­¥ç‹€æ…‹
        function showSyncStatus(message, type) {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.textContent = message;
            statusDiv.className = `sync-status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type !== 'syncing') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        // é˜²æŠ–å‡½å¼
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        window.onload = function() {
            console.log('AA01ç³»çµ±å·²è¼‰å…¥');
            
            // æ”¯æ´ Enter éµç™»å…¥
            document.getElementById('userPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            console.log('ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
        };
    </script>
</body>
</html>

